<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Hello World!</title>
  <style>
    #hello,
    #str-length {
      color: #ff0000;
    }

    #plus>input {
      width: 150px;
    }
  </style>
</head>

<body>
  <h3>C++ Dll hello:
    <span id="hello"></span>
  </h3>

  <div id='plus'>
    <h3 style="display:inline-block">C++ Function Plus:</h3>
    <input type="text" value="1">+
    <input type="text" value="2">=
    <input type="text">
    <button type="button" onclick="plus()">计算</button>
  </div>

  <h3>C++ Function strlen() :
    <span id="str-length">0</span>
    <br>
    <textarea id="str-input" cols="30" rows="10" onchange="strlen(this)" oninput="strlen(this)"
      placeholder="Input something"></textarea>
  </h3>

  We are using node
  <script>
    document.write(process.versions.node)
  </script>, Chrome
  <script>
    document.write(process.versions.chrome)
  </script>, and Electron
  <script>
    document.write(process.versions.electron)
  </script>.

  <script>
    window.onload = function () {
      // try {
      // Call *.dll with ffi
      let ffi = require('ffi-napi', window);
      const path = require('path');
      // Create funtions
      console.log();
      window.Dll = ffi.Library(path.join(__dirname, 'dll/lib/libhelloDll'), {
        "hello": ['int', ['int']],
        "add": ['int', ['int', 'int']]
      })
      console.log(Dll, '---fii.Library result:');
      // Call C++ function Hello
      // document.getElementById('hello').innerHTML = Dll.Hello()
      // } catch (error) {
      //   console.error('ffi.Library', error);
      // }
    }

    function plus() {

      Dll.hello(10);
      console.log(Dll.add(1, 2))

      // let inputs = document.getElementById('plus').getElementsByTagName('input');
      // let a = Number(inputs[1].value),
      //   b = Number(inputs[0].value);
      // // Call C++ function Add
      // let sum = Dll.Add(a, b);
      // console.log(`${a}+${b}=${sum}`);
      // inputs[2].value = sum;
    }

    function strlen(el) {
      // Call C++ function StrLength
      // document.getElementById('str-length').innerHTML = Dll.StrLength(el.value);
      Dll.getSize(10)
    }
  </script>
</body>

</html>