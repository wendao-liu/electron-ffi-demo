<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
<style>
  #title {
    line-height: 30px;
  }

  #pluginsRequests {
    height: 300px;
    overflow: auto;
  }
</style>

<body>
  <div class="root">
    <div class="plugin">
      <b id="title">插件信息</b>
      <div id="pluginsStatus"></div>
      <b id="title">插件请求统计</b>
      <div id="pluginsRequests"></div>
    </div>
</body>

<script>
  socket = io('ws://localhost:8080');
  const keyStatus = {
    "online": "在线",
    "none": "离线"
  }

  function pluginStatus(result) {
    const pluginDom = document.getElementById('pluginsStatus');
    let str = '';
    Object.keys(result).forEach((name, index) => {
      const {
        state
      } = result[name] || {};
      str += `
      ${index}.
     <span>插件名称：${name}</span>
     <span>插件状态：${ keyStatus[state]}</span>
     <br/>
    `
    });
    pluginDom.innerHTML = str;
  }


  function pluginRunFn(result) {
    const pluginDom = document.getElementById('pluginsRequests');
    let str = '';
    result.forEach(({
      pluginName,
      fn
    }, index) => {
      str += `
      ${index}.
     <span>插件名称：${pluginName}</span>
     <span>插件方法：${ fn}</span>
     <br/>
    `
    });
    pluginDom.innerHTML = str;
  }
  socket.on('pluginStatistics', (result) => {
    const {
      requestList
    } = result || {};

    if (requestList) {
      pluginRunFn(requestList)
    } else {
      pluginStatus(result)
    }


  });
  window.onload = () => {

  }
</script>

</html>